RESTful API设计原则
=======================

[原文作者：Thomas Hunter](https://codeplanet.io/author/tlhunter/)
[原文链接：Principles of good RESTful API Design](https:#/codeplanet.io/principles-good-restful-api-design/)

设计优秀的RESTful API真心很难。每个API代表了你和那些使用你的数据的客户间的一份“合同”。毁坏这份合同会给你带来很多愤怒的邮件，以及那些不能再使用他们的移动应用的悲伤客户们。文档是战斗的一半，找出一个喜欢写作的程序员也很难。

构建一个API可以帮助你增加你的服务的价值。通过一个API，你的服务/核心应用拥有了成为其他服务发生的平台的潜力。看这些科技巨擘：Facebook，Twitter，Google，Github，Amazon，Netflix等等，他们中没有一个会想到如果他们没有通过API开放他们的数据，他们不会变成今天这般巨大。事实上，一个完整的工业体系的唯一目标就是前面所说的这样消费数据的平台。

> 你的API越容易使用，会有越多的人们来使用它。

这篇文章的原则是它将跟随你对API的设计，并且将保证你的API的消费者将能够理解发生了什么。并且会剧烈地减少你收到的困惑和/或愤怒的邮件。我将把这些组织为一个个的话题，当然你并不需要按顺序阅读。

### RESTful API设计定义
这里是我将会用到的一些关键字：

* 资源（Resource）：对象的一个单独的实力。例如，一个动物。
* 集合（Collection）：同种对象的集合。例如，动物。
* HTTP：跨网络通信协议
* 消费者（Consumer）：一个可以发出HTTP请求的客户端应用。
* 第三方开发者（Third Party Developer）：一个不是你项目组成员但又想使用你的数据的人。
* 服务器（Server）：一个可被消费者跨网络访问的服务器程序。
* 端点（Endpoint）：服务器上一个代表了某种资源或某个集合的API URL。
* 冪等性（Idempotent）：无副作用，可多次执行。
* URL段（URL Segment）：URL中由斜线分隔的信息块。

### 数据设计和抽象
计划好你的API长什么样要比你认为的还早开始。首先你要考虑你的数据如何设计，以及你的核心服务/应用如何工作。如果你在进行[API优先开发](http://blog.pop.co/post/67465239611/why-we-chose-api-first-development)，那这就简单了。如果你要将一个API添加到一个已有的项目中，那么你可能需要更多的抽象。

偶尔地，一个集合可以代表一个数据库表，一个资源可以代表这个表里的一行。然而，这不是一般情况。事实上，你的API应该远离你的数据和业务逻辑进行抽象。这是非常重要的，否则第三方开发者会被这么多复杂的应用数据所吞没，除非你不打算让他们用你的API了。

这里还有一些你不应该暴露为API的部分服务。一个常见的例子是许多API不允许创建用户。

### 动词
你当然应该知道GET和POST请求。这是你浏览不同的网页时用到最多的两个请求了。POST非常有用，它甚至被嵌入到一些日常语言中。这样人们即使不知道它到底干了什么也可以说给他们FACEBOOK上的朋友POST了一些东西。

这里还有四个半重要的HTTP动词。我说的“半个”指的是PATCH，因为它与PUT非常相似，并且他们常被API开发者混合使用。这些动词，对应了一些数据库调用（我假定大多数读者知道如何操作数据库而不是设计API）。

* GET(SELECT)：接收来自服务器某个特定的资源，或列出一组资源。
* POST(CREATE)：在服务器上创建一个新的资源。
* PUT(UPDATE)：在服务器上更新资源，提供整个资源。
* PATCH(UPDATE)：在服务器上更新资源，仅更新改变的部分。
* DELETE(DELETE)：在服务器上移除资源。

下面是较为罕见的HTTP动词：

* HEAD：接收某个资源的元数据，例如数据的哈希值，或者更新时间。
* OPTIONS：接收允许消费者使用资源的时间。

一个优秀的RESTful API将使用这四个半HTTP动词来允许第三方与它的数据进行交互，并且从不将动作/动词作为URL段。

典型地，GET请求可以被缓存（并且经常是这样）。例如，浏览器将缓存GET请求（依赖于缓存头），并且用户第二次发出POST请求时还有效。一个HEAD请求可以看作是一个没有响应体的GET请求，并且同样可以被缓存。

### 版本控制
不管你是在构建，也不管你有多少要做的事情，你的核心应用要改变，你的数据关系要改变，属性也要被添加到或从资源上移除。软件开发就是如此，并且只要你的项目是活跃的，被很多人使用（比如你构建的API），它一直是这样。

记住API是服务器和消费者之间的一份合同。如果你改变了服务器API，并且这些改变不是向后兼容的，你就破坏了消费者的访问，它们会对你感到生气。继续这样的话，他们就离开了。为了保证你的应用包含了改变，又保证了消费者的心情，你需要偶尔引进新版本的API，并且它仍能被老版本所访问。

作为一个边注，如果你只是给你的API添加了新特性，例如资源上新的属性（不是必须的，没有它资源也能正常工作），或者你正在添加新的端点，你不用增加你的API版本号，因为这些改变不会破坏向后兼容性。你要的只是更新你的文档了。

经过一段时间你可以废弃掉旧的版本。为了废弃一个特性并不意味着将它关闭或减少它的数量，而是告诉消费者这个老版本的API将在某天被移除，他们应该更新为新版本。

一个优秀的RESTful API将在URL中保留版本号，另外通用的做法是将版本号放入请求头，但是当经过与众多的第三方开发者打交道后，我可以告诉你还是让在URL段里省事。

### 分析
记录消费者使用的你的API的版本/端点。这很简单，你只要在每次收到请求时将它们在数据库里的计数加1即可。记录并分析API的使用是个好主意，例如，你最常用的API应该用起来最高效。

为了构建一个第三方开发者喜爱的API，最重要的事情是当你废弃一个API版本时，你实际上可以联系使用废弃的API特性的开发者，这是提醒他们进行升级的最好方式了。

第三方开发者通知的功能可以是自动化的，例如，每当他们访问10,000次废弃的特性时给他们发送一封邮件。

### API根URL
